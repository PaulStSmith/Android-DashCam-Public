<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DashCamアプリ - Androidスマートフォンをプロフェッショナルなドライブレコーダーに変身させます">
    <title>DashCamアプリ - ユーザーマニュアル</title>
    <link rel="icon" type="image/png" sizes="192x192" href="../../images/app-icon-192.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../../images/app-icon-96.png">
    <link rel="icon" type="image/png" sizes="48x48" href="../../images/app-icon-48.png">
    <link rel="apple-touch-icon" href="../../images/app-icon-192.png">
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <img src="../../images/app-icon-96.png" alt="DashCamアプリアイコン" class="app-icon">
                <div class="header-text">
                    <h1>DashCamアプリ — ユーザーマニュアル</h1>
                    <p class="subtitle">バージョン 1.0.0 Beta | Android 8.0+ (API 26+) | 最終更新: 2025年10月30日</p>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="manual.html"  class="active">ユーザーマニュアル</a></li>
            <li><a href="eula.html">利用規約</a></li>
            <li><a href="license.html">ライセンス</a></li>
            <li><a href="privacy-policy.html">プライバシーポリシー</a></li>
        </ul>
    </nav>

    <div class="container">
        <section id="quick-start">
            <h2>クイックスタート</h2>
            <ol>
                <li><strong>インストールと起動:</strong> プロンプトが表示されたら、カメラ、マイク、位置情報の権限を許可してください。</li>
                <li><strong>スマートフォンの取り付け:</strong> フロントガラスに横向きでしっかりと取り付け、背面カメラが前方を向くようにしてください。</li>
                <li><strong>電源の接続:</strong> 車のイグニッション（ACC）と連動する電源に接続してください。電源が検出されると自動的に録画が開始され、電源が切れると録画が停止します。</li>
                <li><strong>ストレージ:</strong> 動画はデフォルトで内部ストレージに保存されます。設定でSDカードや外部ストレージに変更できます。</li>
                <li><strong>アップロード（オプション）:</strong> Wi-Fi経由で自宅のパソコン、NAS、またはクラウドストレージ（Google Drive、OneDrive）へのアップロードを設定できます。</li>
            </ol>
        </section>

        <hr>

        <section id="introduction">
            <h2>はじめに</h2>
            <p>DashCamは、古いAndroidスマートフォンを信頼性の高い多機能なドライブレコーダーに変身させます。<strong>安定性、自動化、シンプルさ</strong>を重視して設計されており、車のエンジンがかかると自動的に録画を開始し、エンジンが停止すると映像を保存またはアップロードします。</p>

            <h3>主な機能</h3>
            <ul>
                <li><strong>自動録画</strong> - イグニッションまたは衝撃検出と連動</li>
                <li><strong>衝撃検出</strong> - サーキュラービデオバッファ付き（衝撃前2分＋衝撃後10秒を保存）</li>
                <li><strong>包括的なテレメトリー:</strong> GPS、速度、6軸モーションセンサーのログ記録</li>
                <li><strong>柔軟なアップロード:</strong> Windows共有フォルダ（SMB/CIFS）またはクラウド（Google Drive、OneDrive）</li>
                <li><strong>複数の出力形式:</strong> MP4動画、SRT字幕、CSVセンサーデータ、GPXトラック</li>
                <li><strong>自動ストレージ管理:</strong> ストレージ不足時の自動削除設定が可能</li>
                <li><strong>キューベースのアップロード:</strong> バックグラウンド処理による自動再試行</li>
                <li><strong>安全な認証情報:</strong> Android Keystoreによる暗号化ストレージ</li>
                <li><strong>NetBIOSサポート:</strong> IPアドレスの代わりにWindowsホスト名が使用可能</li>
                <li><strong>バッテリー最適化:</strong> 最小限の電力消費で連続動作するよう設計</li>
                <li><strong>タッチ不要の動作:</strong> 一度インストールすれば、毎日の使用に操作は不要</li>
            </ul>
        </section>

        <hr>

        <section id="getting-started">
            <h2>はじめ方</h2>

            <h3>権限</h3>
            <p>初回起動時に以下の権限を許可してください:</p>
            <ul>
                <li><strong>カメラ</strong> – 動画録画に必要です。</li>
                <li><strong>マイク</strong> – 録画時の音声キャプチャに必要です。</li>
                <li><strong>位置情報</strong> – GPS座標、速度のログ記録、Wi-Fi SSID検出（アップロード制限）に必要です。</li>
                <li><strong>ストレージ</strong> – （Android 9以下）録画をデバイスに保存するために必要です。</li>
            </ul>

            <h3>バッテリー最適化</h3>
            <p>DashCamは初回起動時に<strong>バッテリー最適化の除外</strong>を要求します。これにより、アプリは以下が可能になります:</p>
            <ul>
                <li>画面がオフの時も録画を継続</li>
                <li>電源切断後にアップロードを完了</li>
                <li>AUTOモードで衝撃を監視</li>
            </ul>
            <p>バッテリー最適化の状態は<strong>設定 → システム設定</strong>で確認できます。</p>

            <h3>スマートフォンの取り付け</h3>
            <ul>
                <li>安定した前方視界が得られる<strong>フロントガラスまたはダッシュボード用マウント</strong>を使用してください。</li>
                <li>ケーブルを整理して、視界の妨げにならないようにしてください。</li>
                <li>自動動作のため、イグニッション（ACC）に配線された充電器から電源を接続してください。</li>
            </ul>

            <h3>電源の動作</h3>
            <ul>
                <li><strong>イグニッションオン（電源接続）:</strong> 録画が自動的に開始されます。</li>
                <li><strong>イグニッションオフ（電源切断）:</strong> 録画が安全に停止し、（設定されている場合）アップロードが開始されます。スマートフォンはアップロードを完了するまで起動状態を維持し、その後スリープして電力を節約します。</li>
            </ul>
        </section>

        <hr>

        <section id="main-screen">
            <h2>メイン画面</h2>

            <h3>表示レイアウト</h3>
            <ul>
                <li><strong>左上:</strong> 現在の日付と時刻（設定で形式変更可能）</li>
                <li><strong>右上:</strong> 設定ボタン + アップロード状態インジケーター</li>
                <li><strong>左下:</strong> GPS座標、コンパス方位、録画状態</li>
                <li><strong>右下:</strong> 現在の速度（mphまたはkm/h、設定変更可能）</li>
                <li><strong>中央:</strong> ライブカメラプレビュー</li>
                <li><strong>中央右:</strong> 手動録画ボタン（FAB）</li>
            </ul>

            <h3>状態インジケーター</h3>
            <ul>
                <li><strong>REC（赤枠）:</strong> 現在動画を録画中</li>
                <li><strong>AUTO（緑枠）:</strong> AUTOモードのバッファが動作中（衝撃待機）</li>
                <li><strong>手動録画ボタン:</strong>
                    <ul>
                        <li>赤い円（⏺） = 録画していない、タップで開始</li>
                        <li>白い四角（⏹） = 録画中、タップで停止</li>
                    </ul>
                </li>
            </ul>

            <h3>アップロードインジケーター（右上）</h3>
            <ul>
                <li><strong>緑のアップロードアイコン（⏫）:</strong> アクティブなアップロード進行中（件数表示）</li>
                <li><strong>オレンジの一時停止アイコン（⏸）:</strong> アップロード一時停止中（件数表示、タップでキュービューアーを開く）</li>
                <li><strong>赤い警告アイコン（⚠️）:</strong> アップロードエラー（件数表示、タップでエラーを表示）</li>
            </ul>

            <div class="alert alert-warning">
                <p><strong>注意:</strong> 「エミュレーター – 動画録画無効」と表示される場合、Androidエミュレーターで実行しています。動画録画には、カメラを搭載した実機が必要です。</p>
            </div>
        </section>

        <hr>

        <section id="recording-modes">
            <h2>録画モード</h2>

            <h3>1. AUTO（衝撃検出）</h3>
            <p>日常のドライブに最適 — 重要な瞬間のみを保存してストレージを節約します。</p>
            <ul>
                <li>連続した1分間のセグメントをサーキュラーバッファに録画</li>
                <li>メモリ内に直近2分間のみを保持（衝撃前30秒以上を保証）</li>
                <li>加速度センサーが衝撃を検出すると、DashCamは:
                    <ul>
                        <li>2分間のバッファ（衝撃前）を保存</li>
                        <li>追加で10秒間（衝撃後）を録画</li>
                        <li>すべてのテレメトリーデータと共に完全な録画を保存</li>
                    </ul>
                </li>
                <li><strong>衝撃感度:</strong> 高（1.5G）、中（2.0G、デフォルト）、低（3.0G）</li>
                <li><strong>ファイル名:</strong> <code>DashCam-20250115-143022-Impact.mp4</code></li>
                <li><strong>電源の動作:</strong> 電源イベントを無視（衝撃のみに反応）</li>
            </ul>

            <h3>2. PER_TRIP</h3>
            <p>電源サイクルごとに1つの連続録画 — 完全なトリップ記録に最適です。</p>
            <ul>
                <li>電源接続時（イグニッションオン）に自動的に開始</li>
                <li>電源切断時（イグニッションオフ）に停止</li>
                <li>設定可能なデバウンス遅延（0-60秒、デフォルト10秒）で短時間の電源変動中の停止を防止</li>
                <li>自動トリップ番号付け: 既存ファイルをスキャンして重複を回避</li>
                <li><strong>ファイル名:</strong> <code>DashCam-20250115-Trip01.mp4</code></li>
            </ul>

            <h3>3. タイムドループ（5/10/30分）</h3>
            <p>録画を固定長のセグメントに分割して、管理とアップロードを容易にします。</p>
            <ul>
                <li>5分、10分、または30分ごとに新しいセグメントを作成</li>
                <li>時刻の区切りに整列（例: 10分モード: :00、:10、:20、:30、:40、:50）</li>
                <li>電源が切断されるまで自動的に次のセグメントを再開</li>
                <li>ファイルサイズとアップロードの利便性のバランスに最適</li>
                <li><strong>ファイル名:</strong> <code>DashCam-20250115-1430.mp4</code>（セグメント境界に丸められる）</li>
            </ul>

            <h3>4. 手動</h3>
            <p>完全なコントロール — いつでも録画できます。</p>
            <ul>
                <li>赤い円ボタンをタップして録画を開始</li>
                <li>白い四角ボタンをタップして録画を停止</li>
                <li>電源状態や他の設定に関係なく使用可能</li>
                <li>自動録画モードから独立</li>
            </ul>

            <div class="alert alert-tip">
                <p><strong>ヒント:</strong> AUTOモードがバックグラウンドで動作している間でも、いつでも手動録画を使用できます。</p>
            </div>
        </section>

        <hr>

        <section id="settings">
            <h2>設定の概要</h2>

            <h3>表示設定</h3>
            <ul>
                <li><strong>速度単位:</strong> mphまたはkm/h</li>
                <li><strong>日付形式:</strong> MM/DD/YYYY、DD/MM/YYYY、またはYYYY-MM-DD</li>
                <li><strong>時刻形式:</strong> 12時間または24時間</li>
                <li><strong>画面を常にオンにする:</strong> 録画中の画面タイムアウトを防止</li>
            </ul>

            <h3>動画設定</h3>
            <ul>
                <li><strong>動画品質:</strong>
                    <ul>
                        <li>720p（50 MB/分） — 長距離ドライブ、限られたストレージ</li>
                        <li>1080p（80 MB/分、デフォルト） — バランスの取れた品質</li>
                        <li>2160p/4K（200 MB/分） — 最大の詳細、大容量ストレージが必要</li>
                    </ul>
                </li>
            </ul>

            <h3>録画設定</h3>
            <ul>
                <li><strong>録画モード:</strong> AUTO、PER_TRIP、5MIN、10MIN、30MIN</li>
                <li><strong>衝撃感度:</strong> 高（1.5G）、中（2.0G、デフォルト）、低（3.0G）
                    <br><em>AUTOモードでのみ表示</em>
                </li>
                <li><strong>ストレージの場所:</strong> 内部ストレージまたは外部（SDカード/USB）</li>
                <li><strong>カスタムフォルダーを選択:</strong> 外部ストレージパスを選択（SAFフォルダーピッカー）</li>
            </ul>

            <h3>アップロード設定</h3>
            <ul>
                <li><strong>自動アップロードを有効化:</strong> 録画後の自動アップロードを切り替え</li>
                <li><strong>従量制接続を許可:</strong> モバイルデータ経由でのアップロードを有効化（デフォルト: Wi-Fiのみ）</li>
                <li><strong>アップロード後に削除:</strong> アップロード成功後にローカルファイルを自動削除</li>
                <li><strong>アップロードキュービューアー:</strong> アップロードキューを監視・管理</li>
                <li><strong>アップロード先:</strong> SMB、Google Drive、またはOneDrive</li>
                <li><strong>宛先の設定:</strong> 各タイプの詳細セクションを参照</li>
            </ul>

            <h3>ストレージ管理</h3>
            <ul>
                <li><strong>ストレージの自動管理:</strong> ストレージ不足時に最も古い録画を自動削除（デフォルト: 有効）</li>
                <li><strong>目標空き容量:</strong> 設定可能な閾値 1-20 GB（デフォルト: 5 GB）
                    <ul>
                        <li>警告レベル: 空き容量3 GB未満</li>
                        <li>クリティカルレベル: 空き容量2 GB未満</li>
                    </ul>
                </li>
                <li><strong>リアルタイム状態:</strong> 色分けされた警告付きの現在の空き容量表示</li>
            </ul>

            <h3>電源管理</h3>
            <ul>
                <li><strong>電源切断デバウンス:</strong> 電源喪失時の停止前の遅延（0-60秒、デフォルト10秒）
                    <br><em>短時間の電源変動中の録画停止を防止</em>
                </li>
            </ul>

            <h3>システム設定</h3>
            <ul>
                <li><strong>バッテリー最適化の状態:</strong> アプリがバッテリー最適化から除外されているかを表示</li>
                <li><strong>バッテリー設定を開く:</strong> Androidのバッテリー最適化設定への直接リンク</li>
            </ul>

            <h3>法的情報とドキュメント</h3>
            <ul>
                <li>ユーザーマニュアル（本ドキュメント）</li>
                <li>エンドユーザーライセンス契約（EULA）</li>
                <li>ソフトウェアライセンス</li>
                <li>プライバシーポリシー</li>
            </ul>
        </section>

        <hr>

        <section id="storage">
            <h2>ストレージ管理</h2>

            <h3>デフォルトの保存場所</h3>
            <code>/Android/data/com.dashcam.app/files/DashCam/</code>
            <p>これはアプリ固有のストレージで、Android 10以降では特別な権限なしでアクセスできます。</p>

            <h3>外部またはSDカードストレージ</h3>
            <ol>
                <li><strong>設定 → 録画設定 → ストレージの場所</strong>に移動します。</li>
                <li><strong>外部</strong>を選択します。</li>
                <li><strong>カスタムフォルダーを選択</strong>をタップし、SDカードまたはUSBストレージのパスを選択します。</li>
                <li>プロンプトが表示されたら権限を許可します（Storage Access Framework）。</li>
            </ol>
            <div class="alert alert-tip">
                <p><strong>ヒント:</strong> 外部ストレージは大容量のSDカードやUSBドライブに最適です。録画中はストレージデバイスが接続されたままになるようにしてください。</p>
            </div>

            <h3>ファイル形式と出力</h3>
            <p>各録画は<strong>4つの同期されたファイル</strong>を作成します:</p>
            <ul>
                <li><strong>.mp4</strong> — 音声付きH.264動画（30 fps）</li>
                <li><strong>.srt</strong> — GPS、速度、日付/時刻を含むSubRip字幕（1秒間隔）</li>
                <li><strong>.csv</strong> — センサーデータ: 加速度計、ジャイロスコープ、磁力計、光、気圧、近接（10 Hzサンプリング）</li>
                <li><strong>.gpx</strong> — GPX 1.1 XML形式のGPSトラック（マッピングソフトウェアと互換性あり）</li>
            </ul>

            <h3>ファイルサイズ（概算）</h3>
            <table>
                <thead>
                    <tr>
                        <th>品質</th>
                        <th>MB/分</th>
                        <th>1時間の録画</th>
                        <th>推奨用途</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>720p</td>
                        <td>50</td>
                        <td>約3 GB</td>
                        <td>長距離ドライブ、限られたストレージ</td>
                    </tr>
                    <tr>
                        <td>1080p</td>
                        <td>80</td>
                        <td>約4.8 GB</td>
                        <td>バランスの取れた品質（デフォルト）</td>
                    </tr>
                    <tr>
                        <td>2160p/4K</td>
                        <td>200</td>
                        <td>約12 GB</td>
                        <td>最大の詳細、大容量ストレージ</td>
                    </tr>
                    <tr>
                        <td>テレメトリー</td>
                        <td>&lt;0.2</td>
                        <td>&lt;12 MB</td>
                        <td>全モード（無視できる程度）</td>
                    </tr>
                </tbody>
            </table>

            <h3>自動ストレージ管理</h3>
            <p><strong>ストレージの自動管理</strong>が有効な場合（デフォルト）、DashCamは空き容量が設定した閾値を下回ると自動的に最も古い録画を削除します。</p>
            <ul>
                <li><strong>デフォルト閾値:</strong> 空き容量5 GB</li>
                <li><strong>設定可能な範囲:</strong> 1-20 GB</li>
                <li><strong>削除動作:</strong> 録画セット全体（4ファイル一緒に）を古い順に削除</li>
                <li><strong>警告レベル:</strong> 3 GB未満（警告）または2 GB未満（クリティカル）で視覚的アラート</li>
            </ul>
            <div class="alert alert-warning">
                <p><strong>重要:</strong> 自動管理を無効にする場合は、録画失敗を防ぐため手動でストレージを監視してください。</p>
            </div>
        </section>

        <hr>

        <section id="uploads">
            <h2>アップロードの設定</h2>
            <p>DashCamは、<strong>Windows共有フォルダ <small>(SMB/CIFS)</small></strong>、<strong>Google Drive</strong>、<strong>OneDrive</strong>への自動アップロードをサポートしています。キューベースのアップロードシステムは、自動再試行、バックグラウンド処理、リアルタイム監視機能を備えています。</p>

            <h3>アップロードのトリガー</h3>
            <p>アップロードは3つの方法でトリガーされます:</p>
            <ol>
                <li><strong>自動（録画後）:</strong> 自動アップロードが有効な場合、録画完了直後にアップロード</li>
                <li><strong>手動で全てをキューに追加:</strong> 手動から自動アップロードモードに切り替えると、既存の全録画をキューに追加</li>
                <li><strong>バックグラウンド再試行:</strong> 失敗したアップロードは指数バックオフで自動再試行（30秒、60秒、120秒、240秒、480秒）</li>
            </ol>

            <h3>ネットワーク要件</h3>
            <ul>
                <li><strong>Wi-Fi推奨:</strong> デフォルトでは、Wi-Fiネットワーク上でのみアップロードが行われます</li>
                <li><strong>従量制を許可:</strong> この設定を有効にすると、モバイルデータ経由でのアップロードが許可されます（データ料金が発生する可能性があります）</li>
                <li><strong>アクティブな接続:</strong> アップロード中、デバイスにインターネット接続が必要です</li>
            </ul>

            <h3>アップロードキュービューアー</h3>
            <p><strong>設定 → アップロード設定 → アップロードキュービューアー</strong>からキュービューアーにアクセスして以下を行えます:</p>
            <ul>
                <li><strong>進行状況の監視:</strong> プログレスバー付きのリアルタイムアップロード状態</li>
                <li><strong>一時停止/再開:</strong> アップロード処理を制御（状態はアプリ再起動後も保持）</li>
                <li><strong>エラーの再試行:</strong> 失敗したアップロードを手動で再試行</li>
                <li><strong>履歴の表示:</strong> 以前にアップロードされた録画を確認</li>
                <li><strong>再アップロード:</strong> 必要に応じて以前成功したファイルを再アップロード</li>
                <li><strong>キューのクリア:</strong> キューに入っている全アイテムを削除してストレージを再スキャン</li>
            </ul>

            <h3>キューの状態</h3>
            <ul>
                <li><strong>IDLE:</strong> キューに追加済み、アップロード待機中</li>
                <li><strong>UPLOADING:</strong> 現在転送中</li>
                <li><strong>ERROR:</strong> 失敗（キューを停止、手動再試行が必要）</li>
                <li><strong>DONE:</strong> アップロード成功（履歴に保持）</li>
            </ul>

            <hr>

            <h3>Windows共有フォルダ <small>(SMB/CIFS)</small> の設定</h3>
            <p>録画を自宅のパソコン、NAS、またはWindowsサーバーにアップロードします。</p>

            <h4>セットアップ手順</h4>
            <ol>
                <li>設定で、<strong>アップロード先タイプ</strong>を<strong>ネットワークフォルダー</strong>に設定</li>
                <li>接続詳細を設定:
                    <ul>
                        <li><strong>ホスト:</strong> Windowsホスト名（例: <code>MYPC</code>）またはIPアドレス（例: <code>192.168.1.100</code>）</li>
                        <li><strong>共有名:</strong> SMB共有名（例: <code>dashcam</code>）</li>
                        <li><strong>パス:</strong> 共有内のオプションのサブフォルダー（例: <code>recordings/2025</code>）</li>
                        <li><strong>ユーザー名:</strong> Windowsローカルアカウントのユーザー名（ゲストアクセスの場合はオプション）</li>
                        <li><strong>パスワード:</strong> アカウントのパスワード（Android Keystoreで暗号化）</li>
                    </ul>
                </li>
                <li><strong>Wi-Fiネットワーク制限:</strong> オプションで特定のWi-Fi SSIDに制限（カンマ区切り）</li>
                <li>設定で<strong>自動アップロード</strong>を有効化</li>
            </ol>

            <h4>NetBIOSホスト名解決</h4>
            <p>DashCamは<strong>NetBIOS名前解決</strong>をサポートしており、IPアドレスの代わりにWindowsコンピューター名を使用できます。</p>
            <ul>
                <li><strong>要件:</strong> 両方のデバイスが同じWi-Fiネットワーク上にあり、Windowsのネットワーク探索が有効になっていること</li>
                <li><strong>例:</strong> <code>192.168.1.100</code>の代わりに<code>DESKTOP-ABC123</code>を使用</li>
                <li><strong>フォールバック:</strong> ホスト名が失敗した場合はIPアドレスを使用（コマンドプロンプトで<code>ipconfig</code>を実行して確認）</li>
            </ul>
            <blockquote><em>注意: NetBIOSは主にWindowsネットワークで動作します。macOS/Linuxユーザーは、IPアドレスを使用する必要があります。</em></blockquote>

            <h4>Windowsローカルアカウントの作成</h4>
            <p>Windows 10以降では、認証されたアクセスが必要です（ゲスト共有なし）:</p>
            <ol>
                <li><strong>Win + I</strong>を押して、<strong>アカウント</strong> → <strong>家族とその他のユーザー</strong>へ移動</li>
                <li><strong>その他のユーザーをこのPCに追加</strong>をクリック</li>
                <li><strong>このユーザーのサインイン情報がありません</strong>を選択</li>
                <li><strong>Microsoftアカウントを持たないユーザーを追加する</strong>を選択</li>
                <li>ユーザー名（例: <code>dashcam</code>）とパスワードを作成</li>
                <li>共有フォルダーを右クリック → <strong>プロパティ</strong> → <strong>共有</strong>タブ → <strong>共有</strong></li>
                <li>新しいユーザーを<strong>読み取り/書き込み</strong>権限で追加</li>
                <li><strong>セキュリティ</strong>タブも確認し、そこで読み取り/書き込み権限を付与</li>
            </ol>

            <h4>Wi-Fi SSID制限（SMBのみ）</h4>
            <p>特定のネットワークに制限することで、公共Wi-Fi経由でのアップロードを防止します:</p>
            <ul>
                <li><strong>設定:</strong> 指定ネットワークでのみアップロード（カンマ区切りのSSID）</li>
                <li><strong>例:</strong> <code>HomeWiFi,Office5G</code></li>
                <li><strong>動作:</strong> SSIDが設定されている場合、リストされたネットワークに接続している時のみアップロード</li>
                <li><strong>自動追加:</strong> SMBを初めて設定する際、アプリが現在のSSIDを自動的に追加</li>
                <li><strong>空白 = 全てのネットワーク:</strong> 空のままにすると、全てのWi-Fiでアップロードを許可</li>
            </ul>
            <div class="alert alert-warning">
                <p><strong>注意:</strong> SSID制限は<strong>SMB宛先のみ</strong>に適用されます。Google DriveとOneDriveのアップロードは、任意のネットワーク上で動作します（インターネットベースのサービス）。</p>
            </div>

            <hr>

            <h3>Google Driveの設定</h3>
            <p>録画を直接Google Driveアカウントにアップロードします。</p>

            <h4>セットアップ手順</h4>
            <ol>
                <li>設定で、<strong>アップロード先タイプ</strong>を<strong>Google Drive</strong>に設定</li>
                <li><strong>Googleアカウントを接続</strong>をタップ</li>
                <li>ネイティブアカウントピッカーからGoogleアカウントを選択</li>
                <li>DashCamにGoogle Driveへのアクセスを承認（Files.ReadWrite権限）</li>
                <li>フォルダー構造を設定:
                    <ul>
                        <li><strong>ルートフォルダー:</strong> メインフォルダー名（例: <code>DashCam</code>） - 存在しない場合は自動作成</li>
                        <li><strong>サブフォルダー:</strong> オプションのサブフォルダーパス（例: <code>2025/January</code>）</li>
                    </ul>
                </li>
                <li>設定で<strong>自動アップロード</strong>を有効化</li>
            </ol>

            <h4>アップロード方法</h4>
            <ul>
                <li><strong>マルチパートアップロード:</strong> 5 MB未満のファイルは1回のリクエストでアップロード</li>
                <li><strong>再開可能アップロード:</strong> 5 MB以上のファイルは5 MBチャンクでアップロード（中断時に再開可能）</li>
            </ul>

            <h4>認証とセキュリティ</h4>
            <ul>
                <li><strong>OAuth 2.0:</strong> 業界標準の安全な認証</li>
                <li><strong>トークンストレージ:</strong> Android Keystoreで暗号化（利用可能な場合はハードウェアバック）</li>
                <li><strong>自動更新:</strong> トークンは有効期限の5分前に自動更新</li>
                <li><strong>切断:</strong> 「Googleアカウントを切断」をタップしてアクセスを取り消し、トークンをクリア</li>
            </ul>

            <hr>

            <h3>OneDriveの設定</h3>
            <p>録画をMicrosoft OneDriveアカウントにアップロードします。</p>

            <h4>セットアップ手順</h4>
            <ol>
                <li>設定で、<strong>アップロード先タイプ</strong>を<strong>OneDrive</strong>に設定</li>
                <li><strong>Microsoftアカウントを接続</strong>をタップ</li>
                <li>MicrosoftのOAuth 2.0 Webフローでサインイン（WebViewで開きます）</li>
                <li>DashCamにOneDriveへのアクセスを承認（Files.ReadWrite権限）</li>
                <li>フォルダー構造を設定:
                    <ul>
                        <li><strong>ルートフォルダー:</strong> メインフォルダー名（例: <code>DashCam</code>） - 存在しない場合は自動作成</li>
                        <li><strong>サブフォルダー:</strong> オプションのサブフォルダーパス（例: <code>2025/January</code>）</li>
                    </ul>
                </li>
                <li>設定で<strong>自動アップロード</strong>を有効化</li>
            </ol>

            <h4>アップロード方法</h4>
            <ul>
                <li><strong>シンプルアップロード:</strong> 4 MB未満のファイルは1回のリクエストでアップロード</li>
                <li><strong>再開可能セッション:</strong> 4 MB以上のファイルはアップロードセッションを使用（中断時に再開可能）</li>
            </ul>

            <h4>認証とセキュリティ</h4>
            <ul>
                <li><strong>OAuth 2.0:</strong> Microsoft Graph API v1.0認証</li>
                <li><strong>トークンストレージ:</strong> Android Keystoreで暗号化（利用可能な場合はハードウェアバック）</li>
                <li><strong>自動更新:</strong> トークンは有効期限の5分前に自動更新</li>
                <li><strong>切断:</strong> 「Microsoftアカウントを切断」をタップしてアクセスを取り消し、トークンをクリア</li>
            </ul>

            <hr>

            <h3>一般的なアップロード設定</h3>

            <h4>アップロード後に削除</h4>
            <p>有効にすると、DashCamはアップロード成功後に自動的にローカルファイルを削除します。これによりストレージを自動管理できます。</p>
            <ul>
                <li><strong>安全性:</strong> ファイルはアップロード成功が確認された後にのみ削除</li>
                <li><strong>テレメトリー:</strong> 4つのファイル全て（mp4、srt、csv、gpx）を一緒に削除</li>
                <li><strong>追跡:</strong> アップロード状態はDataStoreに保持</li>
            </ul>

            <h4>再試行メカニズム</h4>
            <p>失敗したアップロードはAndroid WorkManagerを介して自動的に再試行されます:</p>
            <ul>
                <li><strong>指数バックオフ:</strong> 30秒、60秒、120秒、240秒、480秒（最大8分）</li>
                <li><strong>最大試行回数:</strong> 諦めるまで5回再試行</li>
                <li><strong>ネットワーク制約:</strong> 従量制/Wi-Fiのみのポリシーを尊重</li>
                <li><strong>バックグラウンド処理:</strong> アプリを閉じた状態でも動作</li>
            </ul>

            <h4>よくあるアップロード失敗</h4>
            <ul>
                <li><strong>ネットワーク利用不可:</strong> キューが一時停止、ネットワークが利用可能になると再試行</li>
                <li><strong>SSID不一致（SMB）:</strong> 許可されたWi-Fiネットワークに接続していない</li>
                <li><strong>認証失敗:</strong> OAuthトークンの有効期限切れまたは無効な認証情報</li>
                <li><strong>宛先利用不可:</strong> SMB共有がオフラインまたはクラウドサービスがダウン</li>
                <li><strong>設定が無効:</strong> 必要な設定が不足（ホスト、共有、アカウント）</li>
            </ul>

            <div class="alert alert-tip">
                <p><strong>ヒント:</strong> メイン画面の右上インジケーターでアップロード状態を監視できます。タップしてキュービューアーを開き、詳細情報を確認してください。</p>
            </div>
        </section>

        <hr>

        <section id="playback">
            <h2>録画の表示</h2>

            <h3>アプリ内再生</h3>
            <p>録画画面から任意の録画をタップすると、同期されたテレメトリーオーバーレイと共に表示されます。</p>
            <ul>
                <li><strong>動画再生:</strong> 標準コントロール（再生/一時停止、シーク、音量）付きの内蔵プレーヤー</li>
                <li><strong>SRT字幕:</strong> GPS、速度、タイムスタンプのオーバーレイを自動表示（位置マッチング）</li>
                <li><strong>タイムライン同期:</strong> テレメトリーデータが動画再生と同期</li>
            </ul>

            <h3>外部再生</h3>
            <p>全てのファイルは外部ソフトウェアと互換性のある標準形式です:</p>
            <ul>
                <li><strong>動画（.mp4）:</strong> VLC、Windows Media Player、QuickTimeなどで再生
                <li><strong>字幕（.srt）:</strong> ほとんどのメディアプレーヤーで動画と一緒に読み込み
                    <ul>
                        <li>VLC: .srtファイルを動画にドラッグするか、同じフォルダーに同じ名前で配置</li>
                        <li>GPS座標、速度、日付/時刻を位置付けされたオーバーレイとして表示</li>
                    </ul>
                </li>
                <li><strong>センサーデータ（.csv）:</strong> Excel、Google Sheets、Python/Rで分析のため開く
                    <ul>
                        <li>列: タイムスタンプ、加速度X/Y/Z、ジャイロX/Y/Z、磁力X/Y/Z、光、気圧、近接</li>
                        <li>10 Hzサンプリング（100ms間隔）</li>
                    </ul>
                </li>
                <li><strong>GPSトラック（.gpx）:</strong> マッピングソフトウェアにインポート
                    <ul>
                        <li>互換性: Google Earth、Garmin BaseCamp、GPX Viewerなど</li>
                        <li>トラックポイントとタイムスタンプ付きのGPX 1.1 XML形式</li>
                    </ul>
                </li>
            </ul>

            <h3>ファイルへのアクセス</h3>
            <ul>
                <li><strong>内部ストレージ:</strong> ファイルマネージャーアプリを使用するか、USB経由でスマートフォンを接続（MTPモード）</li>
                <li><strong>外部ストレージ:</strong> SDカードを取り外してコンピューターに挿入するか、USB接続を使用</li>
                <li><strong>パス:</strong> <code>/Android/data/com.dashcam.app/files/DashCam/</code>（内部）または設定したカスタムパス</li>
            </ul>
        </section>

        <hr>

        <section id="troubleshooting">
            <h2>トラブルシューティング</h2>

            <h3>よくある問題</h3>
            <table>
                <thead>
                    <tr>
                        <th>問題</th>
                        <th>対処法</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>動画プレビューが表示されない</td>
                        <td>Android設定 → アプリ → DashCam → 権限でカメラ権限を許可してください。アプリを再起動してください。</td>
                    </tr>
                    <tr>
                        <td>GPSを取得できない</td>
                        <td>空が見える屋外に移動してください。位置情報の権限が許可され、Android設定でGPSが有効になっていることを確認してください。初回取得に30-60秒かかる場合があります。</td>
                    </tr>
                    <tr>
                        <td>衝撃が検出されない（AUTOモード）</td>
                        <td>設定で感度を高（1.5G）に調整してください。スマートフォンがしっかりと固定されていることを確認してください（緩いマウントは衝撃を吸収します）。マウントを軽くタップしてテストしてください。</td>
                    </tr>
                    <tr>
                        <td>録画が予期せず停止する</td>
                        <td>ストレージ容量を確認してください（自動削除がファイルを削除している可能性があります）。バッテリー最適化の除外が許可されていることを確認してください。電源切断デバウンス設定を確認してください。</td>
                    </tr>
                    <tr>
                        <td>画面オフ時にアプリが閉じる</td>
                        <td>バッテリー最適化の除外を許可してください: 設定 → システム設定 → バッテリー設定を開く → DashCamに対して「最適化しない」を選択してください。</td>
                    </tr>
                    <tr>
                        <td>ストレージ満杯エラー</td>
                        <td>設定でストレージの自動管理を有効にしてください。目標空き容量の閾値を増やしてください。動画品質を下げてください。アップロード後に削除を有効にしてください。</td>
                    </tr>
                </tbody>
            </table>

            <h3>アップロードのトラブルシューティング</h3>
            <table>
                <thead>
                    <tr>
                        <th>問題</th>
                        <th>対処法</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>SMBアップロードが失敗する</td>
                        <td>ホスト/共有/認証情報が正しいことを確認してください。両方のデバイスが同じWi-Fiにあることを確認してください。SSID制限を確認してください。Windowsファイアウォールでポート445を有効にしてください。ローカルWindowsアカウントに読み取り/書き込み権限があることを確認してください。</td>
                    </tr>
                    <tr>
                        <td>ホスト名が見つからない（SMB）</td>
                        <td>Windowsのネットワーク探索が有効になっていることを確認してください。NetBIOSが実行されていることを確認してください。IPアドレスにフォールバックしてください（コマンドプロンプトで<code>ipconfig</code>を実行して確認）。</td>
                    </tr>
                    <tr>
                        <td>Google Drive認証が失敗する</td>
                        <td>アカウントを切断して再接続してください。Googleアカウントがアクティブであることを確認してください。インターネット接続を確認してください。問題が続く場合はアプリデータをクリアしてください。</td>
                    </tr>
                    <tr>
                        <td>OneDrive認証が失敗する</td>
                        <td>アカウントを切断して再接続してください。Microsoftアカウントがアクティブであることを確認してください。インターネット接続を確認してください。WebViewが失敗する場合は別のブラウザーを試してください。</td>
                    </tr>
                    <tr>
                        <td>アップロードがキューで停止する</td>
                        <td>ネットワーク接続を確認してください。Wi-Fiのみ/従量制の設定を確認してください。SSID制限を確認してください（SMB）。キュービューアーを開いてエラーメッセージを確認してください。手動再試行を試してください。</td>
                    </tr>
                    <tr>
                        <td>アップロードがモバイルデータを使用する</td>
                        <td>アップロード設定で「従量制接続を許可」を無効にしてください。アップロードはWi-Fiでのみ行われます。</td>
                    </tr>
                </tbody>
            </table>

            <h3>パフォーマンスのヒント</h3>
            <ul>
                <li><strong>バッテリー最適化:</strong> DashCamのAndroidバッテリー最適化を無効にしてください（設定 → システム設定）</li>
                <li><strong>高品質充電器:</strong> 録画とアップロード中に安定した電源を確保するため、2A以上の充電器を使用してください</li>
                <li><strong>熱管理:</strong> 直射日光への露出を避けてください — 過熱により熱スロットリングやシャットダウンが発生する可能性があります</li>
                <li><strong>ストレージ性能:</strong> 外部ストレージには高品質のSDカード（Class 10、UHS-I以上）を使用してください</li>
                <li><strong>ネットワーク性能:</strong> SMBアップロードの場合、可能であれば5GHz Wi-Fiを使用してください（転送速度が速くなります）</li>
                <li><strong>ストレージのクリーンアップ:</strong> 定期的に古い録画を手動でクリアするか、アップロード後の削除を有効にしてください</li>
            </ul>

            <h3>高度な診断</h3>
            <p>問題が解決しない場合は、Android Logcatで詳細なエラーメッセージを確認してください:</p>
            <ol>
                <li>開発者オプションを有効にする（設定 → 端末情報 → ビルド番号を7回タップ）</li>
                <li>USBデバッグを有効にする（設定 → 開発者オプション）</li>
                <li>コンピューターに接続して実行: <code>adb logcat -s DashCam:*</code></li>
                <li>コンポーネント名（VideoRecorder、UploadManagerなど）でタグ付けされたエラーメッセージを探す</li>
            </ol>
        </section>

        <hr>

        <section id="technical">
            <h2>技術仕様</h2>

            <h3>動画エンコーディング</h3>
            <ul>
                <li><strong>コーデック:</strong> H.264/AVC（MP4コンテナ）</li>
                <li><strong>フレームレート:</strong> 30 fps（固定）</li>
                <li><strong>解像度:</strong> 1280×720、1920×1080、または3840×2160（デバイス依存）</li>
                <li><strong>向き:</strong> 横向き（ドライブレコーダー取り付け用に90°回転）</li>
                <li><strong>音声:</strong> AACコーデック、MP4に含まれる</li>
            </ul>

            <h3>テレメトリーシステム</h3>
            <ul>
                <li><strong>GPSプロバイダー:</strong> Google Play Services Fused Location（1秒更新）</li>
                <li><strong>SRT形式:</strong> 位置付けされたオーバーレイ付きSubRip字幕（左上、左下、右下）</li>
                <li><strong>CSVサンプリング:</strong> 加速度計、ジャイロスコープ、磁力計、光、気圧、近接に対して10 Hz（100ms間隔）</li>
                <li><strong>GPX形式:</strong> トラックポイントとタイムスタンプ付きGPS Exchange Format 1.1 XML</li>
            </ul>

            <h3>衝撃検出</h3>
            <ul>
                <li><strong>アルゴリズム:</strong> ローパスフィルター処理された加速度計の大きさ（alpha=0.8）</li>
                <li><strong>閾値:</strong> 高=1.5G（15 m/s²）、中=2.0G（20 m/s²）、低=3.0G（30 m/s²）</li>
                <li><strong>バッファ:</strong> 2分間のローリングバッファ（1分間セグメント）、10秒間の衝撃後キャプチャ</li>
                <li><strong>更新レート:</strong> 約20ms（SENSOR_DELAY_GAME）</li>
            </ul>

            <h3>ストレージアーキテクチャ</h3>
            <ul>
                <li><strong>内部:</strong> アプリ固有ディレクトリへの直接File API</li>
                <li><strong>外部:</strong> DocumentTree永続化を伴うStorage Access Framework（SAF）</li>
                <li><strong>FileAccessManager:</strong> FileとDocumentFile APIの両方の統一抽象化レイヤー</li>
                <li><strong>動画出力:</strong> FileOutputOptions（内部）、FileDescriptorOutputOptions（外部SAF）</li>
            </ul>

            <h3>アップロードアーキテクチャ</h3>
            <ul>
                <li><strong>SMB/CIFS:</strong> NetBIOS名前解決付きjcifs-ngライブラリ</li>
                <li><strong>Google Drive:</strong> Google Sign-In API + Drive REST API v3（5MB未満はマルチパート、5MB以上は再開可能）</li>
                <li><strong>OneDrive:</strong> Microsoft Graph API v1.0（4MB未満はシンプル、4MB以上は再開可能セッション）</li>
                <li><strong>再試行:</strong> 指数バックオフ付きAndroid WorkManager（最大5回試行）</li>
                <li><strong>キュー:</strong> StateFlowベースの進捗追跡による順次処理</li>
            </ul>

            <h3>セキュリティ</h3>
            <ul>
                <li><strong>OAuthトークン:</strong> EncryptedSharedPreferences + Android Keystoreで暗号化</li>
                <li><strong>SMB認証情報:</strong> Android Keystoreで暗号化（利用可能な場合はハードウェアバック）</li>
                <li><strong>トークン更新:</strong> 有効期限の5分前に自動更新</li>
                <li><strong>権限:</strong> CAMERA、RECORD_AUDIO、ACCESS_FINE_LOCATION、INTERNET、WAKE_LOCK、FOREGROUND_SERVICE、ACCESS_NETWORK_STATE</li>
            </ul>

            <h3>フレームワークとライブラリ</h3>
            <ul>
                <li><strong>UI:</strong> Jetpack Compose（宣言型UI）</li>
                <li><strong>カメラ:</strong> CameraX（品質セレクターフォールバック付き）</li>
                <li><strong>設定:</strong> DataStore（Preferences + Proto）</li>
                <li><strong>並行処理:</strong> Kotlin Coroutines + Flow</li>
                <li><strong>メディア再生:</strong> ExoPlayer</li>
                <li><strong>バックグラウンド作業:</strong> WorkManager</li>
                <li><strong>SMB:</strong> jcifs-ng</li>
            </ul>

            <h3>デバイス要件</h3>
            <ul>
                <li><strong>最小Android:</strong> 8.0 Oreo（API 26）</li>
                <li><strong>ターゲットAndroid:</strong> 14（API 34）</li>
                <li><strong>カメラ:</strong> 背面カメラが必要（前面カメラは非対応）</li>
                <li><strong>センサー:</strong> GPS、加速度計が必要; ジャイロスコープ、磁力計、光、気圧、近接はオプション</li>
                <li><strong>ストレージ:</strong> 最低8 GB推奨（長時間録画には16 GB以上）</li>
            </ul>
        </section>

        <hr>

        <section id="limitations">
            <h2>既知の制限事項</h2>

            <h3>現在の制限事項（ベータ版）</h3>
            <ul>
                <li><strong>エミュレーターサポート:</strong> Androidエミュレーターでは動画録画が無効（CameraXの制限）。テレメトリーのみのモードは動作します。</li>
                <li><strong>MediaMuxer互換性:</strong> AUTOモードで一部のデバイスで失敗する可能性があります（フォールバック: 最後のセグメントのみを保存）</li>
                <li><strong>大きなPER_TRIPファイル:</strong> 極端に長い連続トリップ（1080pで4時間以上）は20 GBを超える可能性があります — 十分なストレージを確保してください</li>
                <li><strong>Wi-Fi位置情報権限:</strong> Android 10以降では、SSIDアクセスにACCESS_FINE_LOCATIONが必要です（Wi-Fi制限）</li>
            </ul>

            <h3>Microsoft OneDriveに関する考慮事項</h3>
            <ul>
                <li><strong>クライアントシークレットの有効期限:</strong> Microsoftクライアントシークレットは2026年10月頃に期限切れになります</li>
                <li><strong>影響:</strong> 有効期限前にアプリの更新またはバックエンドサーバーの実装が必要になります</li>
                <li><strong>対策:</strong> アプリ更新を通じて十分前にユーザーに通知されます</li>
            </ul>

            <h3>予定されている機能</h3>
            <ul>
                <li><strong>熱管理:</strong> 温度監視と録画スロットリング（次の優先事項）</li>
                <li><strong>Dropbox統合:</strong> ユーザーの需要に応じて</li>
                <li><strong>自動化テスト:</strong> テストインフラストラクチャは存在しますが、テストはまだ実装されていません</li>
                <li><strong>ファイルタイプフィルタリング:</strong> TELEMETRY_ONLYアップロードモード用のUI（アーキテクチャは完成）</li>
            </ul>
        </section>

        <hr>

        <section id="safety">
            <h2>安全性と責任</h2>
            <p>DashCamはドライバーを支援しますが、安全運転の<strong>代替</strong>ではありません。車内録画に関する現地の法律を常に遵守してください。</p>
        </section>

        <hr>

        <section id="support">
            <h2>サポートとフィードバック</h2>
            <p>これは<strong>ベータ版リリース</strong>です — 日常使用に安定していますが、開発は継続中です。</p>
            <ul>
                <li>問題や提案はプロジェクトのGitHubページから報告してください。</li>
                <li>スマートフォンのモデル、Androidバージョン、問題の簡単な説明を含めてください。</li>
            </ul>
            <p><strong>DashCamをご利用いただきありがとうございます。安全運転を — そして責任を持って録画してください。</strong></p>
        </section>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 ByteForge. All rights reserved.</p>
            <p>
                <a href="manual.html">ユーザーマニュアル</a> |
                <a href="eula.html">利用規約</a> |
                <a href="license.html">ライセンス</a> |
                <a href="privacy-policy.html">プライバシーポリシー</a>
            </p>
        </div>
    </footer>
</body>
</html>
